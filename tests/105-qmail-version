# $Id$

###########################
# determine qmail version #
###########################

if [ "$SECT" != "9" ]; then

# Set BADUNSET if unset doesn't do the job

A='a'
export A
${UNSET} A
[ -z "$A" ] || BADUNSET='y'

${UNSET} DEFAULT

# correct bouncer for our binaries:
###################################
# NOTE: This is duplicated (and should be) after next ezmlm-make block.
  ${ECHO} "|/${EZBIN}/ezmlm-weed" > "${DIR}/bouncer"
  ${ECHO} "|/${EZBIN}/ezmlm-weed" > "${DIR}/digest/bouncer"
  if [ "$EZVER" = "31" ]; then	# autodetecting bouncer for 0.31x
    ${ECHO} "|/${EZBIN}/ezmlm-return '${DIR}'" >> "${DIR}/bouncer"
    ${ECHO} "|/${EZBIN}/ezmlm-return '${DIR}'" >> "${DIR}/digest/bouncer"
  else				# split bouncer with args for later versions
	# edited for ezmlm-new
    ${ECHO} "|/${EZBIN}/ezmlm-return '${DIR}'" >> "${DIR}/bouncer"
    ${ECHO} "|/${EZBIN}/ezmlm-return '${DIR}'" >> "${DIR}/digest/bouncer"
  fi

  # remove inlocal/inhost - shouldn't be used
  ${RM} -f "${DIR}/inlocal" "${DIR}/inhost" > /dev/null || \
    fatal "failed to remove inlocal/inhost for testlist"

###########################
# set up bouncing account #
###########################
  ${ECHO} "|${GREP} 'MAILER-DAEMON' >/dev/null && exit 99" > "$DOT-$BOUNCE"
  ${ECHO} "|exit 100" > "$DOT-$BOUNCE"

  (
    ${ECHO} "#!/bin/sh"
    ${ECHO} "${CAT} >'${QQMSG}'"
    ${ECHO} "${CAT} <&1 >'${QQENV}'"
    ${ECHO} "${SED} -e '/^$/,\$d' <'${QQMSG}' >'${QQHDR}'"
    ${ECHO} "${SED} -e '1,/^$/d' <'${QQMSG}' >'${QQBODY}'"
    ${ECHO} "cp '${QQMSG}' '${QQMSG}'.\$\$"
    ${ECHO} "exit 0"
  ) > "${QQTEST}"
  ${CHMOD} 755 "${QQTEST}"

fi
