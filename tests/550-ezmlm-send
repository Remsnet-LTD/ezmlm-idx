  prompt "ezmlm-send:           "

  sendfrom() {
    cat >"$TMP" <<EOF
From: ${1:-test@example.org}
Subject: test post
X-Test-Header: one
Content-Length: zip

message goes here
EOF
    ${EZBIN}/ezmlm-send "$DIR" <"$TMP" >"$ERR" 2>&1 || \
	fatal "failed to produce post"
  }

  touch "$DIR"/addtrailer
  LOCAL="$LIST"
  sendfrom

  grephdr_list 1
  grephdr Precedence: bulk
  grephdr X-No-Archive: yes
  grephdr Delivered-To: "mailing list ${LIST}@${HOST}"
  grephdr From: test@example.org
  grephdr Subject: '\[PFX\] test post'
  grephdr X-Test-Header: one
  grephdr Sender: "<${LIST}@${HOST}>"
  grephdr_empty

  grepbody Local: "$LOCAL"
  grepbody local: "$LOCAL"
  grepbody host: "$HOST"
  grepbody num: `cut -d: -f1 "${DIR}/num"`

  rm -f "$DIR"/prefix
  ${EZBIN}/ezmlm-send "$DIR" <"$TMP" >"$ERR" 2>&1 || \
  fatal "failed to produce post"
  grephdr Subject: 'test post'

  touch "$DIR"/rewritefrom

  sendfrom '"My Name 1" <test1@example.org>'
  grephdr From: "\"My Name 1 via ${LIST}\" <${LIST}@${HOST}>$"
  grephdr Cc: '"My Name 1" <test1@example.org>'

  sendfrom '"My Name 2" test2@example.org'
  grephdr From: "\"My Name 2 via ${LIST}\" <${LIST}@${HOST}>$"
  grephdr Cc: '"My Name 2" test2@example.org'

  sendfrom 'My Name 3 <test3@example.org>'
  grephdr From: "\"My Name 3 via ${LIST}\" <${LIST}@${HOST}>$"
  grephdr Cc: 'My Name 3 <test3@example.org>'

  sendfrom 'test4@example.org (My Name 4)'
  grephdr From: "\"My Name 4 via ${LIST}\" <${LIST}@${HOST}>$"
  grephdr Cc: 'test4@example.org \(My Name 4\)'

  sendfrom 'test5@example.org'
  grephdr From: "\"test5.example.org via ${LIST}\" <${LIST}@${HOST}>$"
  grephdr Cc: 'test5@example.org'

  rm -f "$DIR"/rewritefrom

  sendfrom 'test6@yahoo.com'
  grephdr From: "\"test6.yahoo.com via ${LIST}\" <${LIST}@${HOST}>$"
  grephdr Cc: 'test6@yahoo.com'

  echo OK
