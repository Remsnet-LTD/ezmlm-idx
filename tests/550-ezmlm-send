  prompt "ezmlm-send:           "

  sendfrom() {
    cat >"$TMP" <<EOF
From: ${1:-test@example.org}
Subject: test post
X-Test-Header: one
Content-Length: zip

message goes here
EOF
    ${EZBIN}/ezmlm-send "$DIR" <"$TMP" >"$ERR" 2>&1 || \
	fatal "failed to produce post"
  }

  touch "$DIR"/addtrailer
  LOCAL="$LIST"
  sendfrom

  grephdr_list 1
  grephdr Precedence: bulk
  grephdr X-No-Archive: yes
  grephdr Delivered-To: "mailing list ${LIST}@${HOST}"
  grephdr From: test@example.org
  grephdr Subject: '\[PFX\] test post'
  grephdr X-Test-Header: one
  grephdr Sender: "<${LIST}@${HOST}>"
  grephdr_empty

  grepbody Local: "$LOCAL"
  grepbody local: "$LOCAL"
  grepbody host: "$HOST"
  grepbody num: `cut -d: -f1 "${DIR}/num"`

  rm -f "$DIR"/prefix
  ${EZBIN}/ezmlm-send "$DIR" <"$TMP" >"$ERR" 2>&1 || \
  fatal "failed to produce post"
  grephdr Subject: 'test post'

  touch "$DIR"/rewritefrom

  sendfrom '"My Name" <test@example.org>'
  grephdr From: "\"My Name via ${LIST}\" <${LIST}@${HOST}>$"
  grephdr Cc: '"My Name" <test@example.org>'

  sendfrom '"My Name" test@example.org'
  grephdr From: "\"My Name via ${LIST}\" <${LIST}@${HOST}>$"
  grephdr Cc: '"My Name" test@example.org'

  sendfrom 'My Name <test@example.org>'
  grephdr From: "\"My Name via ${LIST}\" <${LIST}@${HOST}>$"
  grephdr Cc: 'My Name <test@example.org>'

  sendfrom 'test@example.org (My Name)'
  grephdr From: "\"My Name via ${LIST}\" <${LIST}@${HOST}>$"
  grephdr Cc: 'test@example.org \(My Name\)'

  sendfrom 'test@example.org'
  grephdr From: "\"test.example.org via ${LIST}\" <${LIST}@${HOST}>$"
  grephdr Cc: 'test@example.org'

  echo OK
